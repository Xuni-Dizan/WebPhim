<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Xem Phim - Phim Lẻ & Phim Bộ Mới Nhất (Responsive)</title>
    <meta name="description" content="Khám phá kho phim và phim bộ đa dạng: hành động, lãng mạn, kinh dị, hài hước... Tìm kiếm nhanh chóng, xem trailer và thông tin chi tiết. Cập nhật liên tục. Giao diện đáp ứng tốt trên mọi thiết bị.">
    <meta name="keywords" content="xem phim, phim online, phim bộ, series phim, phim mới, phim hay, phim HD, phim vietsub, phim thuyết minh, phim hành động, phim tình cảm, phim kinh dị, phim chiếu rạp, responsive">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourdomain.com/index.html"> <meta property="og:title" content="Flick Tale | Kho Phim Lẻ & Phim Bộ Cập Nhật (Responsive)">
    <meta property="og:description" content="Khám phá kho phim lẻ và phim bộ đa dạng với hàng ngàn tựa phim thuộc nhiều thể loại. Trải nghiệm xem phim mượt mà trên mọi thiết bị.">
    <meta property="og:image" content="access/img/FlickTale_og.jpg"> <meta property="og:site_name" content="Flick Tale">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://yourdomain.com/index.html"> <meta property="twitter:title" content="Flick Tale | Kho Phim Lẻ & Phim Bộ Cập Nhật (Responsive)">
    <meta property="twitter:description" content="Khám phá kho phim lẻ và phim bộ đa dạng với hàng ngàn tựa phim thuộc nhiều thể loại. Trải nghiệm xem phim mượt mà trên mọi thiết bị.">
    <meta property="twitter:image" content="access/img/FlickTale_twitter.jpg"> <link rel="icon" href="favicon.ico" sizes="any">
    <link rel="icon" href="access/img/FlickTale.jpg" type="image/jpeg">
    <link rel="apple-touch-icon" href="apple-touch-icon.png"> <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/style.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'heading': ['Montserrat', 'sans-serif'],
                    },
                    colors: {
                        'primary': 'var(--primary-color)',
                        'primary-hover': 'var(--primary-hover-color)',
                        'secondary': 'var(--secondary-color)',
                        'light-gray': 'var(--light-gray-color)',
                        'dark-gray': 'var(--dark-gray-color)',
                        'darker-gray': 'var(--darker-gray-color)',
                        'text-color': 'var(--text-color)',
                        'text-muted': 'var(--text-muted-color)',
                        'text-bright': 'var(--text-bright-color)',
                        'border-color': 'var(--border-color)',
                        'highlight': 'var(--highlight-color)',
                        'gold-accent': 'var(--gold-accent)',
                        'blue-accent': 'var(--blue-accent)',
                        'purple-accent': 'var(--purple-accent)',
                        'green-accent': 'var(--green-accent)',
                    },
                    animation: {
                         'pageFadeIn': 'pageFadeIn var(--animation-duration) var(--animation-timing) forwards',
                         'shimmer': 'shimmer var(--shimmer-duration) infinite linear',
                         'slideUpFadeIn': 'slideUpFadeIn var(--animation-duration) var(--animation-timing) forwards',
                         'heroFadeIn': 'heroFadeIn 1s var(--animation-timing) forwards',
                         'heroContentFadeIn': 'heroContentFadeIn 1.2s var(--animation-timing) forwards 0.3s',
                         'pulse': 'pulse var(--pulse-duration) infinite ease-in-out',
                    },
                    keyframes: {
                         pageFadeIn: { from: { opacity: '0' }, to: { opacity: '1' } },
                         shimmer: { '0%': { left: '-150%' }, '100%': { left: '150%' } },
                         slideUpFadeIn: { from: { opacity: '0', transform: 'translateY(20px)' }, to: { opacity: '1', transform: 'translateY(0)' } },
                         heroFadeIn: { from: { opacity: '0', transform: 'scale(0.98)' }, to: { opacity: '1', transform: 'scale(1)' } },
                         heroContentFadeIn: { from: { opacity: '0', transform: 'translateY(20px)' }, to: { opacity: '1', transform: 'translateY(0)' } },
                         pulse: { '0%, 100%': { transform: 'scale(1)' }, '50%': { transform: 'scale(1.05)' } }
                    }
                }
            }
        }
    </script>

    <style>
        /* Styles for skeleton, search highlight, filter tag, slider, logo, filter transition, search suggestions, filter icon button */
        /* These should mostly be covered by style.css now, but can keep specific overrides if needed */
        /* Styles from style.css will take precedence due to cascade if defined there */
    </style>
</head>
<body class="bg-secondary text-white font-sans">

    <header id="main-header" class="py-3 px-4 md:px-6 lg:px-10">
        <div class="container mx-auto flex justify-between items-center max-w-screen-xl">
            <a href="index.html" class="header-logo-link" aria-label="Trang chủ Flick Tale">
                <img src="access/img/logo.png" alt="Logo Flick Tale" class="header-logo">
            </a>

            <nav class="hidden md:flex flex-grow justify-center space-x-5 lg:space-x-7 items-center" aria-label="Điều hướng chính">
                <a href="index.html" class="active-link-primary" aria-current="page">Trang Chủ</a>
                <a href="pages/anime.html" id="nav-anime">Anime</a>
                <a href="pages/hoat_hinh_2D_3D.html" id="nav-2d3d">Phim 2D/3D</a>
            </nav>

            <div class="hidden md:flex items-center space-x-3 lg:space-x-4 flex-shrink-0">
                <a href="#filter-controls" id="nav-filter-icon" class="filter-icon-button p-2 rounded-full hover:bg-light-gray" aria-label="Mở bộ lọc">
                    <i class="fas fa-filter text-lg"></i>
                </a>
                <div class="relative search-container">
                    <label for="search-input-desktop" class="sr-only">Tìm kiếm phim hoặc phim bộ</label>
                    <input 
                        type="text" 
                        id="search-input-desktop" 
                        placeholder="Tìm kiếm phim, anime..." 
                        class="search-input"
                        aria-label="Tìm kiếm" 
                        autocomplete="off" 
                        aria-haspopup="listbox" 
                        aria-controls="search-suggestions-desktop" 
                        aria-expanded="false"
                    >
                    <span class="search-icon" aria-hidden="true">
                        <i class="fas fa-search"></i>
                    </span>
                    <div 
                        id="search-suggestions-desktop" 
                        role="listbox" 
                        class="search-suggestions mt-2"
                        aria-label="Gợi ý tìm kiếm"
                    >
                        <div class="no-suggestions-placeholder">Nhập để tìm kiếm...</div>
                    </div>
                </div>
                <button class="text-gray-300 hover:text-white transition duration-300 p-2 rounded-full hover:bg-light-gray" aria-label="Tài khoản người dùng">
                    <i class="fas fa-user text-lg"></i>
                </button>
            </div>

            <div class="md:hidden flex items-center space-x-2">
                <a href="#filter-controls" id="mobile-nav-filter-icon" class="filter-icon-button p-2 rounded-full hover:bg-light-gray" aria-label="Mở bộ lọc">
                    <i class="fas fa-filter text-xl"></i>
                </a>
                <button id="search-icon-mobile" class="text-gray-300 hover:text-white transition duration-300 p-2 rounded-full hover:bg-light-gray" aria-label="Mở tìm kiếm" aria-expanded="false" aria-controls="mobile-search-container">
                    <i class="fas fa-search text-xl"></i>
                </button>
                <button id="mobile-menu-button" class="text-gray-300 hover:text-white transition duration-300 p-2 rounded-full hover:bg-light-gray" aria-label="Mở menu" aria-expanded="false" aria-controls="mobile-menu-panel">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>

        <div id="mobile-search-container" class="md:hidden hidden mt-3 px-4 pb-3 relative">
            <div class="search-container relative">
                <label for="search-input-mobile" class="sr-only">Tìm kiếm phim hoặc phim bộ</label>
                <input 
                    type="text" 
                    id="search-input-mobile" 
                    placeholder="Tìm kiếm phim, anime..." 
                    class="search-input" 
                    aria-label="Tìm kiếm trên di động" 
                    autocomplete="off" 
                    aria-haspopup="listbox" 
                    aria-controls="search-suggestions-mobile" 
                    aria-expanded="false"
                >
                <span class="search-icon" aria-hidden="true"> 
                    <i class="fas fa-search"></i>
                </span>
                <div 
                    id="search-suggestions-mobile" 
                    role="listbox" 
                    class="search-suggestions mt-2" 
                    aria-label="Gợi ý tìm kiếm di động"
                >
                    <div class="no-suggestions-placeholder">Nhập để tìm kiếm...</div>
                </div>
            </div>
        </div>
    </header>

    <div id="mobile-menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden hidden"></div>
    <div id="mobile-menu-panel" class="fixed top-0 right-0 bottom-0 w-64 bg-light-gray p-5 pt-16 shadow-lg z-50 transform translate-x-full transition-transform duration-300 ease-in-out md:hidden">
        <button id="close-mobile-menu-button" class="absolute top-4 right-4 p-2 text-gray-400 hover:text-white" aria-label="Đóng menu">
            <i class="fas fa-times text-2xl"></i>
        </button>
        <nav class="flex flex-col space-y-4" aria-label="Điều hướng di động">
            <a href="index.html" class="block py-2 px-3 text-white bg-primary rounded font-semibold" aria-current="page">Trang Chủ</a>
            <a href="pages/anime.html" id="mobile-nav-anime" class="block py-2 px-3 text-gray-200 hover:bg-gray-700 rounded font-medium">Anime</a>
            <a href="pages/hoat_hinh_2D_3D.html" id="mobile-nav-2d3d" class="block py-2 px-3 text-gray-200 hover:bg-gray-700 rounded font-medium">Phim 2D/3D</a>
            <hr class="border-gray-600 my-3">
             <a href="#" class="block py-2 px-3 text-gray-200 hover:bg-gray-700 rounded font-medium flex items-center gap-2">
                 <i class="fas fa-user w-4 text-center"></i> Tài Khoản
             </a>
        </nav>
    </div>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 max-w-screen-xl">

        <section id="hero-section" class="relative min-h-[70vh] flex items-end md:items-center text-white bg-cover bg-center bg-no-repeat mb-8 md:mb-10 rounded-lg overflow-hidden shadow-xl" style="background-image: url('https://placehold.co/1920x1080/000000/333333?text=Loading+Hero...');" aria-labelledby="hero-title">
            <div class="hero-overlay absolute inset-0 z-10" aria-hidden="true"></div>
            <div class="hero-content relative z-20 max-w-xl px-4 pb-8 md:px-0 md:pl-8 lg:pl-16 md:pb-0 text-center md:text-left">
                <div class="flex flex-wrap mb-3">
                    </div>
                <h1 id="hero-title" class="hero-title text-3xl sm:text-4xl md:text-5xl font-bold mb-3 md:mb-4">Đang tải...</h1>
                <div class="hero-meta mb-3 md:mb-4 flex flex-wrap items-center text-sm opacity-90">
                    <div class="hero-meta-item mr-4">
                        <i class="far fa-calendar-alt mr-1"></i> <span id="hero-year">N/A</span>
                    </div>
                    <div class="hero-meta-item mr-4">
                        <i class="fas fa-film mr-1"></i> <span id="hero-type">N/A</span>
                    </div>
                    <div class="hero-meta-item hero-rating">
                        <i class="fas fa-star mr-1"></i> <span id="hero-rating">N/A</span>
                    </div>
                </div>
                <p id="hero-description" class="hero-description text-sm sm:text-base md:text-lg mb-5 md:mb-6 line-clamp-3 sm:line-clamp-4">Đang tải mô tả...</p>
                <div class="hero-button-container flex flex-wrap gap-3 justify-center md:justify-start">
                    <button id="hero-play-button" class="hero-play-button">
                        <i class="fas fa-play" aria-hidden="true"></i> Xem Ngay
                    </button>
                    <button id="hero-detail-button" class="hero-detail-button">
                        <i class="fas fa-info-circle" aria-hidden="true"></i> Chi Tiết
                    </button>
                </div>
            </div>
        </section>

        <section id="tabs-section" class="mb-6 border-b border-gray-700">
            <div id="content-tabs" class="flex space-x-1 overflow-x-auto whitespace-nowrap" role="tablist" aria-label="Chọn loại nội dung">
                <button id="tab-movies" role="tab" aria-selected="true" aria-controls="movie-grid-section" class="tab-button active px-4 py-2 sm:px-6">
                    <i class="fas fa-film mr-2" aria-hidden="true"></i> Phim Lẻ & Anime Movie
                </button>
                <button id="tab-series" role="tab" aria-selected="false" aria-controls="movie-grid-section" class="tab-button px-4 py-2 sm:px-6">
                    <i class="fas fa-tv mr-2" aria-hidden="true"></i> Phim Bộ & Anime Series
                </button>
            </div>
        </section>

        <section id="filter-controls" aria-labelledby="filter-heading" class="mb-4 p-4 bg-light-gray rounded-lg shadow-md hidden">
             <div class="flex flex-wrap gap-4 items-start">
                 <h2 id="filter-heading" class="text-lg sm:text-xl font-semibold text-gray-100 w-full sm:w-auto flex-shrink-0 mb-2 sm:mb-0">Bộ Lọc</h2>
                 <div class="flex-grow grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 w-full">
                     <div id="genre-filter-container" class="relative">
                         <label for="genre-filter-button" class="block text-sm font-medium text-gray-300 mb-1">Thể loại</label>
                         <button id="genre-filter-button" type="button" class="w-full bg-dark-gray border border-border-color text-white text-sm rounded-lg focus:ring-primary focus:border-primary p-2.5 text-left flex justify-between items-center" aria-haspopup="true" aria-expanded="false" aria-controls="genre-dropdown">
                             <span class="truncate">Chọn thể loại...</span>
                             <i class="fas fa-chevron-down text-xs text-gray-400 ml-2 flex-shrink-0"></i>
                         </button>
                         <div id="genre-dropdown" class="absolute hidden mt-1 w-full rounded-md shadow-lg bg-dark-gray ring-1 ring-black ring-opacity-5 z-20 p-2 space-y-1 max-h-60 overflow-y-auto" role="listbox" aria-label="Danh sách thể loại">
                             </div>
                     </div>

                     <div>
                         <label for="sort-filter" class="block text-sm font-medium text-gray-300 mb-1">Sắp xếp theo</label>
                         <select id="sort-filter" name="sort" class="w-full bg-dark-gray border border-border-color text-white text-sm rounded-lg focus:ring-primary focus:border-primary p-2.5 appearance-none custom-select-arrow" aria-label="Chọn tiêu chí sắp xếp">
                             <option selected value="default">Mặc định</option>
                             <option value="newest">Mới nhất</option>
                             <option value="rating_desc">Đánh giá cao nhất</option>
                             <option value="rating_asc">Đánh giá thấp nhất</option>
                             <option value="title_asc">Tên A-Z</option>
                             <option value="title_desc">Tên Z-A</option>
                         </select>
                     </div>

                     <div>
                         <label for="format-filter" class="block text-sm font-medium text-gray-300 mb-1">Định dạng</label>
                         <select id="format-filter" name="format" class="w-full bg-dark-gray border border-border-color text-white text-sm rounded-lg focus:ring-primary focus:border-primary p-2.5 appearance-none custom-select-arrow" aria-label="Chọn định dạng phim">
                             <option selected value="all">Tất cả định dạng</option>
                             <option value="2D">2D</option>
                             <option value="3D">3D</option>
                             <option value="Animation">Hoạt Hình</option>
                             <option value="Live Action">Người Đóng</option>
                             </select>
                     </div>

                     <div id="year-slider-container" class="slider-container lg:col-span-1 xl:col-span-1">
                        <label class="slider-label">Năm phát hành: <span id="year-slider-values">Tất cả</span></label>
                        <div id="year-slider" class="noui-slider-target"></div>
                     </div>

                     <div id="rating-slider-container" class="slider-container lg:col-span-1 xl:col-span-1">
                         <label class="slider-label">Điểm đánh giá: <span id="rating-slider-values">Tất cả</span></label>
                         <div id="rating-slider" class="noui-slider-target"></div>
                     </div>
                 </div>
                 <div class="w-full sm:w-auto flex items-end flex-shrink-0 mt-4 sm:mt-0">
                     <button id="clear-filters-button" title="Xóa tất cả bộ lọc" class="hidden p-2 text-gray-400 hover:text-white bg-dark-gray rounded-lg border border-border-color hover:bg-gray-700 transition duration-200 ml-auto sm:ml-2" aria-label="Xóa bộ lọc">
                         <span class="material-icons-outlined text-lg">close</span>
                     </button>
                 </div>
             </div>
         </section>

         <div id="filter-tags-container" class="mb-4 flex flex-wrap gap-2">
             </div>

        <section id="movie-grid-section" role="tabpanel" aria-labelledby="tab-movies">
            <h2 id="movie-grid-title" class="text-xl sm:text-2xl font-semibold mb-6 text-gray-100">Phim Lẻ & Anime Movie</h2>
            <div id="movie-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 sm:gap-4 md:gap-5" aria-live="polite">
                <!-- Skeleton cards will be populated here by JS initially -->
            </div>
            <p id="no-movies-found" class="text-text-muted col-span-full hidden text-center py-8">Không tìm thấy nội dung nào phù hợp.</p>
        </section>

    </main>

    <footer class="bg-darker-gray text-gray-400 py-12 px-4 sm:px-6 lg:px-8 mt-16 border-t border-border-color" role="contentinfo">
        <div class="container mx-auto max-w-screen-xl grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="space-y-4">
                <a href="index.html" class="inline-block mb-2" aria-label="Trang chủ Flick Tale">
                    <span class="text-xl font-bold text-white">Flick Tale</span>
                    </a>
                <p class="text-sm pr-4">
                    Khám phá thế giới điện ảnh với hàng ngàn phim lẻ và phim bộ hấp dẫn. Cập nhật liên tục, chất lượng cao.
                </p>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-white mb-4">Liên Kết Nhanh</h3>
                <nav class="space-y-2" aria-label="Liên kết phụ">
                    <a href="about.html" class="block hover:text-white hover:underline transition duration-300 text-sm">Về Chúng Tôi</a>
                    <a href="pages/auth/dieu_khoan_su_dung.html" class="block hover:text-white hover:underline transition duration-300 text-sm">Điều Khoản Sử Dụng</a>
                    <a href="pages/auth/chinh_sach_bao_mat.html" class="block hover:text-white hover:underline transition duration-300 text-sm">Chính Sách Bảo Mật</a>
                    <a href="pages/auth/lien_he_ho_tro.html" class="block hover:text-white hover:underline transition duration-300 text-sm">Liên Hệ Hỗ Trợ</a>
                    <a href="pages/hoat_hinh_2D_3D.html" class="block hover:text-white hover:underline transition duration-300 text-sm">Phim 2D/3D</a>
                    <a href="pages/anime.html" class="block hover:text-white hover:underline transition duration-300 text-sm">Anime</a>
                </nav>
            </div>

            <div>
                <h3 class="text-lg font-semibold text-white mb-4">Theo Dõi Chúng Tôi</h3>
                <div class="flex space-x-4 mb-4" aria-label="Liên kết mạng xã hội">
                    <a href="#" class="hover:text-white transition duration-300 text-xl" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="hover:text-white transition duration-300 text-xl" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="hover:text-white transition duration-300 text-xl" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="hover:text-white transition duration-300 text-xl" aria-label="Youtube"><i class="fab fa-youtube"></i></a>
                </div>
                <h3 class="text-lg font-semibold mb-2 mt-6">Thông Tin Liên Hệ</h3>
                <p class="text-sm">Email: support@flicktale.com</p> <p class="text-sm">Hotline: 1900-1234</p>
           </div>
       </div>
       <div class="mt-10 pt-8 border-t border-gray-700 text-center">
           <p class="text-sm">© <span id="footer-year">2025</span> Flick Tale. Mọi quyền được bảo lưu.</p> <p class="text-xs mt-2 opacity-70">
               Tuyên bố miễn trừ trách nhiệm: Trang web này chỉ dành cho mục đích trình diễn và học tập.
           </p>
       </div>
    </footer>

    <button id="scroll-to-top" class="hidden fixed bottom-5 right-5 w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-lg transition-opacity duration-300 z-50" aria-label="Cuộn lên đầu trang">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
        const footerYearSpan = document.getElementById('footer-year');
        if (footerYearSpan) {
            footerYearSpan.textContent = new Date().getFullYear();
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wnumb/1.2.0/wNumb.min.js"></script>

    <script src="js/searchUtils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const header = document.getElementById('main-header');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenuPanel = document.getElementById('mobile-menu-panel');
            const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
            const closeMobileMenuButton = document.getElementById('close-mobile-menu-button');
            const searchIconMobile = document.getElementById('search-icon-mobile');
            const mobileSearchContainer = document.getElementById('mobile-search-container');
            const searchInputDesktop = document.getElementById('search-input-desktop');
            const searchSuggestionsDesktop = document.getElementById('search-suggestions-desktop');
            const searchInputMobile = document.getElementById('search-input-mobile');
            const searchSuggestionsMobile = document.getElementById('search-suggestions-mobile');
            const navFilterIcon = document.getElementById('nav-filter-icon');
            const mobileNavFilterIcon = document.getElementById('mobile-nav-filter-icon');
            const genreDropdown = document.getElementById('genre-dropdown');
            const genreButton = document.getElementById('genre-filter-button');
            const filterControls = document.getElementById('filter-controls');
            const scrollToTopBtn = document.getElementById('scroll-to-top'); // Added scroll-to-top

            // Mobile Menu
            const openMobileMenu = () => { 
                mobileMenuPanel?.classList.remove('translate-x-full'); 
                mobileMenuPanel?.classList.add('translate-x-0'); 
                mobileMenuOverlay?.classList.remove('hidden'); 
                mobileMenuButton?.setAttribute('aria-expanded', 'true'); 
                document.body.style.overflow = 'hidden'; 
            };
            
            const closeMobileMenu = () => { 
                mobileMenuPanel?.classList.remove('translate-x-0'); 
                mobileMenuPanel?.classList.add('translate-x-full'); 
                mobileMenuOverlay?.classList.add('hidden'); 
                mobileMenuButton?.setAttribute('aria-expanded', 'false'); 
                document.body.style.overflow = ''; 
            };
            
            mobileMenuButton?.addEventListener('click', openMobileMenu);
            closeMobileMenuButton?.addEventListener('click', closeMobileMenu);
            mobileMenuOverlay?.addEventListener('click', closeMobileMenu);

            // Mobile Search Toggle
            searchIconMobile?.addEventListener('click', () => { 
                const isHidden = mobileSearchContainer?.classList.toggle('hidden'); 
                if (!isHidden) {
                    mobileSearchContainer?.classList.add('active');
                    searchInputMobile?.focus();
                } else {
                    mobileSearchContainer?.classList.remove('active');
                    if (typeof SearchUtils !== 'undefined' && typeof SearchUtils.hideAllSearchSuggestions === 'function') {
                        SearchUtils.hideAllSearchSuggestions();
                    }
                }
                searchIconMobile.setAttribute('aria-expanded', String(!isHidden)); 
            });

            // Search Input Handling (Global variables currentFilters, filterAndSortContent, allMovies, allSeries are defined in script.js)
            const handleSearchInput = (event) => {
                const inputEl = event.target; 
                const suggestionsEl = inputEl === searchInputDesktop ? searchSuggestionsDesktop : searchSuggestionsMobile; 
                const term = inputEl.value.trim();
                
                if (typeof window.currentFilters !== 'undefined' && typeof window.filterAndSortContent === 'function') {
                    window.currentFilters.search = term.toLowerCase();
                    SearchUtils.debounce(() => window.filterAndSortContent(), 300)();
                }
                
                SearchUtils.debounce(() => {
                    if (typeof SearchUtils !== 'undefined' && typeof SearchUtils.displaySearchSuggestions === 'function') {
                        const allItems = [...(window.allMovies || []), ...(window.allSeries || [])];
                        SearchUtils.displaySearchSuggestions(term, inputEl, suggestionsEl, allItems, {
                            maxResults: 8
                        });
                    }
                }, 150)();
            };
            
            searchInputDesktop?.addEventListener('input', handleSearchInput);
            searchInputMobile?.addEventListener('input', handleSearchInput);

            // Genre Dropdown Toggle
            genreButton?.addEventListener('click', (event) => { 
                event.stopPropagation(); 
                if (genreDropdown) { 
                    const isHidden = genreDropdown.classList.toggle('hidden'); 
                    genreButton.setAttribute('aria-expanded', String(!isHidden)); 
                } 
            });

            // Click Outside Logic
            document.addEventListener('click', (event) => {
                const target = event.target;
                
                const isInsideGenreFilter = genreDropdown?.contains(target) || genreButton?.contains(target);
                const isInsideFilterControls = filterControls?.contains(target);
                const isFilterIcon = navFilterIcon?.contains(target) || mobileNavFilterIcon?.contains(target);
                const isInsideDesktopSearch = searchInputDesktop?.contains(target) || searchSuggestionsDesktop?.contains(target);
                const isInsideMobileSearch = searchInputMobile?.contains(target) || searchSuggestionsMobile?.contains(target) || searchIconMobile?.contains(target);

                if (filterControls && !filterControls.classList.contains('hidden') && !isInsideFilterControls && !isFilterIcon) { 
                    filterControls.classList.add('hidden'); 
                }
                
                if (!isInsideGenreFilter && genreDropdown && !genreDropdown.classList.contains('hidden')) { 
                    genreDropdown.classList.add('hidden'); 
                    genreButton?.setAttribute('aria-expanded', 'false'); 
                }

                if (!isInsideDesktopSearch && !isInsideMobileSearch) {
                    if (typeof SearchUtils !== 'undefined' && typeof SearchUtils.hideAllSearchSuggestions === 'function') {
                        SearchUtils.hideAllSearchSuggestions();
                    }
                }
            });

            // Search Submit (Enter Key)
            const handleSearchSubmit = (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    const searchTerm = event.target.value.trim();
                    
                    if (typeof window.currentFilters !== 'undefined' && typeof window.filterAndSortContent === 'function') {
                        window.currentFilters.search = searchTerm.toLowerCase();
                        window.filterAndSortContent();
                    }
                    
                    if (typeof SearchUtils !== 'undefined' && typeof SearchUtils.hideAllSearchSuggestions === 'function') {
                        SearchUtils.hideAllSearchSuggestions();
                    }
                    event.target.blur();
                }
            };
            
            searchInputDesktop?.addEventListener('keydown', handleSearchSubmit);
            searchInputMobile?.addEventListener('keydown', handleSearchSubmit);

            // Sticky Header
            let lastScrollTop = 0;
            window.addEventListener('scroll', function() {
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                if (header) {
                    if (scrollTop > lastScrollTop && scrollTop > header.offsetHeight) { 
                        header.classList.add('header-hidden'); 
                        header.classList.remove('header-shadow'); 
                    }
                    else { 
                        header.classList.remove('header-hidden'); 
                        header.classList.toggle('header-shadow', scrollTop > 50 || !header.classList.contains('header-hidden')); 
                    }
                }
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;

                 // Scroll to top button visibility
                if (scrollToTopBtn) {
                    const isVisible = window.scrollY > 300;
                    scrollToTopBtn.classList.toggle('visible', isVisible);
                    scrollToTopBtn.classList.toggle('hidden', !isVisible);
                }
            }, false); // Use false for passive listener if supported and not preventing default

            // Scroll to top button click
            if (scrollToTopBtn) {
                scrollToTopBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }


            // Filter Icon Click Handler
            const handleFilterIconClick = (event) => {
                event.preventDefault();
                if (filterControls) {
                    const isHidden = filterControls.classList.toggle('hidden');
                    if (!isHidden) { 
                        setTimeout(() => { 
                            filterControls.scrollIntoView({ behavior: 'smooth', block: 'start' }); 
                        }, 50); 
                    }
                }
                
                if (mobileMenuPanel && !mobileMenuPanel.classList.contains('translate-x-full') && event.currentTarget === mobileNavFilterIcon) { 
                    closeMobileMenu(); 
                }
            };
            
            navFilterIcon?.addEventListener('click', handleFilterIconClick);
            mobileNavFilterIcon?.addEventListener('click', handleFilterIconClick);

             // Initialize keyboard navigation for search suggestions
            if (typeof SearchUtils !== 'undefined' && typeof SearchUtils.setupKeyboardNavigation === 'function') {
                if (searchInputDesktop && searchSuggestionsDesktop) {
                    SearchUtils.setupKeyboardNavigation(searchInputDesktop, searchSuggestionsDesktop);
                }
                if (searchInputMobile && searchSuggestionsMobile) {
                    SearchUtils.setupKeyboardNavigation(searchInputMobile, searchSuggestionsMobile);
                }
            }
            console.log("Inline header script for index.html loaded and integrated with SearchUtils.");
        });
    </script>
    <script src="js/script.js" defer></script>
</body>
</html>